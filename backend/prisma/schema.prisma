generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  firstName     String
  lastName      String
  role          String    @default("EMPLOYEE") // ADMIN, EMPLOYEE
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  managedCases    Case[]    @relation("CaseManager")
  caseAssignments CaseAssignment[]
  uploadedDocuments Document[]
  caseTasks       CaseTask[]    @relation("CaseTaskAssignee")
  createdCaseTasks CaseTask[]   @relation("CaseTaskCreator")
}

model Case {
  id          String           @id @default(uuid())
  caseNumber  String           @unique
  title       String
  description String?
  clientName  String
  status      String           @default("OPEN") // OPEN, IN_PROGRESS, UNDER_REVIEW, PENDING_CLIENT, SETTLED, CLOSED, ARCHIVED
  priority    String           @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  startDate   DateTime?
  dueDate     DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  managerId   String?
  manager     User?            @relation("CaseManager", fields: [managerId], references: [id])

  assignments CaseAssignment[]
  documents   Document[]
  tasks       CaseTask[]
}

model CaseAssignment {
  id          String         @id @default(uuid())
  caseId      String
  userId      String

  case        Case           @relation(fields: [caseId], references: [id], onDelete: Cascade)
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime       @default(now())

  @@unique([caseId, userId])
}

model CaseTask {
  id            String         @id @default(uuid())
  title         String
  description   String?
  status        String         @default("TO_DO") // TO_DO, IN_PROGRESS, DONE, BLOCKED
  priority      String         @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  dueDate       DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  caseId        String
  case          Case           @relation(fields: [caseId], references: [id], onDelete: Cascade)

  assignedToId  String?
  assignedTo    User?          @relation("CaseTaskAssignee", fields: [assignedToId], references: [id])

  creatorId     String
  createdBy     User           @relation("CaseTaskCreator", fields: [creatorId], references: [id])
}

model Document {
  id          String       @id @default(uuid())
  fileName    String
  originalName String
  filePath    String
  fileSize    Int
  mimeType    String
  documentType String      // PDF, IMAGE, VIDEO, AUDIO, DOCUMENT, OTHER
  description String?
  uploadedAt  DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  caseId      String?
  case        Case?        @relation(fields: [caseId], references: [id], onDelete: Cascade)

  uploadedById String
  uploadedBy   User        @relation(fields: [uploadedById], references: [id], onDelete: Cascade)

  @@index([caseId])
  @@index([uploadedById])
}
